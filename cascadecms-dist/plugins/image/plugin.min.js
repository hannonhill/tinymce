!function(){var a={},b=function(b){for(var c=a[b],e=c.deps,f=c.defn,g=e.length,h=new Array(g),i=0;i<g;++i)h[i]=d(e[i]);var j=f.apply(null,h);if(void 0===j)throw"module ["+b+"] returned undefined";c.instance=j},c=function(b,c,d){if("string"!=typeof b)throw"module id must be a string";if(void 0===c)throw"no dependencies for "+b;if(void 0===d)throw"no definition function for "+b;a[b]={deps:c,defn:d,instance:void 0}},d=function(c){var d=a[c];if(void 0===d)throw"module ["+c+"] was undefined";return void 0===d.instance&&b(c),d.instance},e=function(a,b){for(var c=a.length,e=new Array(c),f=0;f<c;++f)e.push(d(a[f]));b.apply(null,b)},f={};f.bolt={module:{api:{define:c,require:e,demand:d}}};var g=c,h=function(a,b){g(a,[],function(){return b})};h("4",tinymce.util.Tools.resolve),g("1",["4"],function(a){return a("tinymce.PluginManager")}),g("2",["4"],function(a){return a("tinymce.util.Tools")}),g("5",["4"],function(a){return a("tinymce.Env")}),g("6",["4"],function(a){return a("tinymce.util.JSON")}),g("7",["4"],function(a){return a("tinymce.util.XHR")}),g("8",["4"],function(a){return a("tinymce.ui.Throbber")}),g("e",["4"],function(a){return a("tinymce.util.Promise")}),h("d",document),g("9",["e","2","d"],function(a,b,c){return function(c){function d(a,b){return a?a.replace(/\/$/,"")+"/"+b.replace(/^\//,""):b}function e(a,b,e,f){var g,h;g=new XMLHttpRequest,g.open("POST",c.url),g.withCredentials=c.credentials,g.upload.onprogress=function(a){f(a.loaded/a.total*100)},g.onerror=function(){e("Image upload failed due to a XHR Transport error. Code: "+g.status)},g.onload=function(){var a;return g.status<200||g.status>=300?void e("HTTP Error: "+g.status):(a=JSON.parse(g.responseText),a&&"string"==typeof a.location?void b(d(c.basePath,a.location)):void e("Invalid JSON: "+g.responseText))},h=new FormData,h.append("file",a.blob(),a.filename()),g.send(h)}function f(b,c){return new a(function(a,d){try{c(b,a,d,i)}catch(a){d(a.message)}})}function g(a){return a===e}function h(b){return!c.url&&g(c.handler)?a.reject("Upload url missng from the settings."):f(b,c.handler)}var i=function(){};return c=b.extend({credentials:!1,handler:e},c),{upload:h}}}),h("b",Math),g("a",["2","b","d"],function(a,b,c){var d=function(a,d){function e(a,b){f.parentNode&&f.parentNode.removeChild(f),d({width:a,height:b})}var f=c.createElement("img");f.onload=function(){e(b.max(f.width,f.clientWidth),b.max(f.height,f.clientHeight))},f.onerror=function(){e()};var g=f.style;g.visibility="hidden",g.position="fixed",g.bottom=g.left=0,g.width=g.height="auto",c.body.appendChild(f),f.src=a},e=function(b,c,d){var e=function(a,b){return a.length>b?a.substr(0,b-1)+"...":a},f=function(b,d){var g;return d=d||[],a.each(b,function(a){"string"==typeof a&&(a={text:a,value:a}),g={text:a.text||a.title},g.text=e(g.text,50),a.menu?g.menu=f(a.menu):(g.value=a.value,c&&c(g)),d.push(g)}),d};return f(b,d||[])},f=function(a){return a&&(a=a.replace(/px$/,"")),a},g=function(a){return a.length>0&&/^[0-9]+$/.test(a)&&(a+="px"),a},h=function(a){if(a.margin){var b=a.margin.split(" ");switch(b.length){case 1:a["margin-top"]=a["margin-top"]||b[0],a["margin-right"]=a["margin-right"]||b[0],a["margin-bottom"]=a["margin-bottom"]||b[0],a["margin-left"]=a["margin-left"]||b[0];break;case 2:a["margin-top"]=a["margin-top"]||b[0],a["margin-right"]=a["margin-right"]||b[1],a["margin-bottom"]=a["margin-bottom"]||b[0],a["margin-left"]=a["margin-left"]||b[1];break;case 3:a["margin-top"]=a["margin-top"]||b[0],a["margin-right"]=a["margin-right"]||b[1],a["margin-bottom"]=a["margin-bottom"]||b[2],a["margin-left"]=a["margin-left"]||b[1];break;case 4:a["margin-top"]=a["margin-top"]||b[0],a["margin-right"]=a["margin-right"]||b[1],a["margin-bottom"]=a["margin-bottom"]||b[2],a["margin-left"]=a["margin-left"]||b[3]}delete a.margin}return a},i=function(a){return a.ImageAssetChooser},j=function(a){return i(a).getAssetFromChosen()},k=function(a,b){b.ImageAssetChooser=a},l=function(){return Cascade},m=function(){return $(c.getElementById("chooser-imageId"))},n=function(){return c.getElementById("imagePath")},o=function(a){return a?"CONTEXT_PATH/render/file.act?path="+encodeURI(a):""},p=function(a){return null!==a.match(/^(?:site:\/\/|\/)\w/)};return{getImageSize:d,buildListItems:e,removePixelSuffix:f,addPixelSuffix:g,mergeMargins:h,getAssetChooser:i,getChosenFromAssetChooser:j,setAssetChooser:k,getGlobalCascadeVariable:l,getInternalLinkChooser:m,getInternalLinkChooserPathFieldElement:n,internalPathToRenderFileURL:o,isInternalUrl:p}}),h("c",RegExp),g("3",["5","6","2","7","8","9","a","b","c","d"],function(a,b,c,d,e,f,g,h,i,j){return function(b){function e(a){var c,e,f,h="CONTEXT_PATH/imagepopup.act?src=<IMG_SRC>&currentSiteId="+g.getGlobalCascadeVariable().Variables.get("currentSiteId"),i=b.selection,j=b.dom;c=i.getNode(),e=j.getParent(c,"figure.image"),e&&(c=j.select("img",e)[0]),f=c?j.getAttrib(c,"src"):"",g.isInternalUrl(f)||(f=""),d.send({url:h.replace("<IMG_SRC>",encodeURIComponent(f)),error:function(){a("")},success:function(b){a(b)}})}function f(a,b){d.send({url:"CONTEXT_PATH/ajax/getAssetInfo.act?type=file&path="+a,error:function(){b("")},success:function(a){b(a.dom?a.dom.tOrDN:"")}})}function i(d){function e(a){var b=r.find("#altContainer")[0],c=b._parent,d=r.find("#altHelpText")[0]._parent,e=r.find("#decorative")[0],f=e.checked();a=a!==!1,c[f?"hide":"show"](),d[f?"hide":"show"](),a&&e.focus()}function i(){var a=this.checked(),b=r.find("#"+("source_type_internal"===this.name()?"source_type_external":"source_type_internal"));return this.name()==="source_type_"+z.source_type?void this.checked(!0):(this.checked(a),b.checked(!a),"source_type_internal"===this.name()&&this.checked()?(r.find("#internalSrc").show(),r.find("#externalSrc").hide(),z.source_type="internal"):(r.find("#internalSrc").hide(),r.find("#externalSrc").show(),z.source_type="external"),void p())}function j(a){return b.schema.getTextBlockElements()[a.nodeName]}function k(){var a,b,c,d;a=r.find("#width")[0],b=r.find("#height")[0],a&&b&&(c=a.value(),d=b.value(),r.find("#constrain")[0].checked()&&u&&v&&c&&d&&(u!=c?(d=h.round(c/u*d),isNaN(d)||b.value(d)):(c=h.round(d/v*c),isNaN(c)||a.value(c))),u=c,v=d)}function l(){if(b.settings.image_advtab){var a=r.toJSON(),c=A.parseStyle(a.style);c=g.mergeMargins(c),a.vspace&&(c["margin-top"]=c["margin-bottom"]=g.addPixelSuffix(a.vspace)),a.hspace&&(c["margin-left"]=c["margin-right"]=g.addPixelSuffix(a.hspace)),a.border&&(c["border-width"]=g.addPixelSuffix(a.border)),r.find("#style").value(A.serializeStyle(A.parseStyle(A.serializeStyle(c))))}}function m(){if(b.settings.image_advtab){var a=r.toJSON(),c=A.parseStyle(a.style);r.find("#vspace").value(""),r.find("#hspace").value(""),c=g.mergeMargins(c),(c["margin-top"]&&c["margin-bottom"]||c["margin-right"]&&c["margin-left"])&&(c["margin-top"]===c["margin-bottom"]?r.find("#vspace").value(g.removePixelSuffix(c["margin-top"])):r.find("#vspace").value(""),c["margin-right"]===c["margin-left"]?r.find("#hspace").value(g.removePixelSuffix(c["margin-right"])):r.find("#hspace").value("")),c["border-width"]&&r.find("#border").value(g.removePixelSuffix(c["border-width"])),r.find("#style").value(A.serializeStyle(A.parseStyle(A.serializeStyle(c))))}}function n(a){function c(){a.onload=a.onerror=null,b.selection&&(b.selection.select(a),b.nodeChanged())}a.onload=function(){z.width||z.height||!C||A.setAttribs(a,{width:a.clientWidth,height:a.clientHeight}),c()},a.onerror=c}function o(){var a,d;if(l(),k(),z=c.extend(z,r.toJSON()),z.source_type_internal){var e=g.getChosenFromAssetChooser(b).path,f=e.match(/(.*):([^\/].*)/);if(""===e||"/"===e)return b.windowManager.alert("Please choose an image asset to insert."),!1;z.src=f?"site://"+f[1]+"/"+f[2]:e,z.src=g.internalPathToRenderFileURL(z.src)}else if(z.src=z.externalSrc,""===z.src||"http://"===z.src)return b.windowManager.alert("Please fill in the image URL."),!1;return z.alt||(z.alt=""),z.title||(z.title=""),z.decorative||(z.decorative=!1),""===z.width&&(z.width=null),""===z.height&&(z.height=null),z.style||(z.style=null),z.decorative||z.alt.length?(z.decorative&&(z.alt=""),z={src:z.src,alt:z.alt,title:z.title,width:z.width,height:z.height,style:z.style,caption:z.caption,"class":z["class"]},void b.undoManager.transact(function(){if(!z.src)return void(s&&(A.remove(s),b.focus(),b.nodeChanged()));if(""===z.title&&(z.title=null),s?(A.setAttribs(s,z),z.alt.length||s.setAttribute("alt","")):(z.id="__mcenew",b.focus(),b.selection.setContent(A.createHTML("img",z)),s=A.get("__mcenew"),A.setAttrib(s,"id",null)),b.editorUpload.uploadImagesAuto(),z.caption===!1&&A.is(s.parentNode,"figure.image")&&(a=s.parentNode,A.insertAfter(s,a),A.remove(a)),z.caption!==!0)n(s);else if(!A.is(s.parentNode,"figure.image")){d=s,s=s.cloneNode(!0),a=A.create("figure",{"class":"image"}),a.appendChild(s),a.appendChild(A.create("figcaption",{contentEditable:!0},"Caption")),a.contentEditable=!1;var c=A.getParent(d,j);c?A.split(c,d,a):A.replace(a,d),b.selection.select(a)}})):(b.windowManager.alert("Please provide an Image Description to ensure that your content is accessible. If this is a decorative image, please mark it as decorative."),!1)}function p(a){var c=g.getChosenFromAssetChooser(b).path,d="external"===z.source_type?r.find("#externalSrc")[0].value():g.internalPathToRenderFileURL(c);g.getImageSize(d,function(a){C&&(a.width&&a.height?(u=a.width,v=a.height):(u="",v=""),r.find("#width").value(u),r.find("#height").value(v))}),D||"internal"!==z.source_type||f(c,function(a){a&&r.find("#alt").value(a)})}function q(){D=!0}var r,s,t,u,v,w,x,y,z={},A=b.dom,B=b.settings,C=B.image_dimensions!==!1,D=!1;s=b.selection.getNode(),t=A.getParent(s,"figure.image"),t&&(s=A.select("img",t)[0]),s&&("IMG"!=s.nodeName||s.getAttribute("data-mce-object")||s.getAttribute("data-mce-placeholder"))&&(s=null),s&&(u=A.getAttrib(s,"width"),v=A.getAttrib(s,"height"),z={src:A.getAttrib(s,"src"),alt:A.getAttrib(s,"alt"),title:A.getAttrib(s,"title"),"class":A.getAttrib(s,"class"),width:u,height:v,caption:!!t},z.decorative=!z.alt.length),b.settings.image_class_list&&("object"!=typeof b.settings.image_class_list[0]&&b.settings.image_class_list.unshift({text:"None",value:""}),z["class"]&&b.settings.image_class_list.indexOf(z["class"])===-1&&b.settings.image_class_list.push(z["class"]),w={name:"class",type:"listbox",label:"Class",style:"max-width:100%;",values:g.buildListItems(b.settings.image_class_list,function(a){a.value&&(a.textStyle=function(){return b.formatter.getCssText({inline:"img",classes:[a.value]})})})}),z.source_type=null===s||g.isInternalUrl(z.src)?"internal":"external";var E=[];if(y={name:"externalSrc",type:"textbox",size:40,label:"Image",value:"external"===z.source_type?z.src:"http://",onchange:p},d.length&&(E.push({type:"container",label:"Image Source",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"source_type_internal",type:"checkbox",checked:"internal"===z.source_type,onclick:i,text:"Internal"},{name:"source_type_external",type:"checkbox",checked:"external"===z.source_type,onclick:i,text:"External"}]}),y.hidden="external"!==z.source_type,y={type:"container",name:"sourceContainer",label:"Image",minHeight:55,items:[y,{name:"internalSrc",type:"container",hidden:"internal"!==z.source_type,html:d}]}),E.push(y),b.settings.image_description!==!1&&(E.push({type:"container",label:"Decorative",layout:"flex",direction:"column",align:"left",spacing:5,items:[{name:"decorative",type:"checkbox",checked:z.decorative,onclick:e,text:"This is a decorative image, no description needed."}]}),E.push({type:"container",label:"Image description",name:"altContainer",layout:"flex",direction:"column",align:"left",spacing:5,items:[{name:"alt",type:"textbox",size:25,onchange:q}]}),E.push({type:"container",label:"",layout:"flex",direction:"column",align:"center",spacing:5,items:[{name:"altHelpText",type:"label",text:"Image's title, display name or custom text",classes:"image-decoration-help-block"}]})),b.settings.image_title&&E.push({name:"title",type:"textbox",label:"Image Title"}),C&&E.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:k,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:k,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}),E.push(w),b.settings.image_advtab||b.settings.images_upload_url){var F=[];b.settings.image_caption&&a.ceFalse&&F.push({name:"caption",type:"checkbox",label:"Figure/Caption",text:"Use figure and figcaption for this image"});var G=[{title:"General",type:"form",items:E}];b.settings.image_advtab&&(s&&(s.style.marginLeft&&s.style.marginRight&&s.style.marginLeft===s.style.marginRight&&(z.hspace=g.removePixelSuffix(s.style.marginLeft)),s.style.marginTop&&s.style.marginBottom&&s.style.marginTop===s.style.marginBottom&&(z.vspace=g.removePixelSuffix(s.style.marginTop)),s.style.borderWidth&&(z.border=g.removePixelSuffix(s.style.borderWidth)),z.style=b.dom.serializeStyle(b.dom.parseStyle(b.dom.getAttrib(s,"style")))),F.push({label:"Style",name:"style",type:"textbox",onchange:m}),F.push({type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:l},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}),G.push({title:"Advanced",type:"form",pack:"start",items:F})),r=b.windowManager.open({title:"Insert/edit image",data:z,bodyType:"tabpanel",body:G,onSubmit:o})}else r=b.windowManager.open({title:"Insert/edit image",data:z,body:E,onSubmit:o});e(!1),x=g.getInternalLinkChooser(),g.setAssetChooser(x.assetChooser().data("cs.chooser"),b),x.on("clear.cs.chooser submit.cs.chooser.panel",p)}function j(){e(i)}return{open:j}}}),g("0",["1","2","3"],function(a,b,c){return a.add("image",function(a){a.on("preInit",function(){function c(a){var b=a.attr("class");return b&&/\bimage\b/.test(b)}function d(a){return function(d){function e(b){b.attr("contenteditable",a?"true":null)}for(var f,g=d.length;g--;)f=d[g],c(f)&&(f.attr("contenteditable",a?"false":null),b.each(f.getAll("figcaption"),e))}}a.parser.addNodeFilter("figure",d(!0)),a.serializer.addNodeFilter("figure",d(!1))}),a.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:c(a).open,stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"}),a.addMenuItem("image",{icon:"image",text:"Image",onclick:c(a).open,context:"insert",prependToContext:!0}),a.addCommand("mceImage",c(a).open)}),function(){}}),d("0")()}();