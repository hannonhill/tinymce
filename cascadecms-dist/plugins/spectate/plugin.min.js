!function(){var a={},b=function(b){for(var c=a[b],e=c.deps,f=c.defn,g=e.length,h=new Array(g),i=0;i<g;++i)h[i]=d(e[i]);var j=f.apply(null,h);if(void 0===j)throw"module ["+b+"] returned undefined";c.instance=j},c=function(b,c,d){if("string"!=typeof b)throw"module id must be a string";if(void 0===c)throw"no dependencies for "+b;if(void 0===d)throw"no definition function for "+b;a[b]={deps:c,defn:d,instance:void 0}},d=function(c){var d=a[c];if(void 0===d)throw"module ["+c+"] was undefined";return void 0===d.instance&&b(c),d.instance},e=function(a,b){for(var c=a.length,e=new Array(c),f=0;f<c;++f)e.push(d(a[f]));b.apply(null,b)},f={};f.bolt={module:{api:{define:c,require:e,demand:d}}};var g=c,h=function(a,b){g(a,[],function(){return b})};h("5",tinymce.util.Tools.resolve),g("1",["5"],function(a){return a("tinymce.html.Node")}),g("2",["5"],function(a){return a("tinymce.PluginManager")}),g("6",["5"],function(a){return a("tinymce.Env")}),g("3",["1","6"],function(a,b){var c=function(c){return function(c){for(var d,e,f,g,h=c.length;h--;)d=c[h],d.parent&&(e=d.attr("class")||"",e.indexOf("spectate-form")!==-1&&(f=d.next.getAll("#text")[0]||null,f&&f.value.indexOf("spectate")!==-1&&(d.next.remove(),g=new a("img",1),g.shortEnded=!0,g.attr({width:"100%",height:d.attr("data-spectate-form-height")||"500",style:"background-image:url('CONTEXT_PATH/assets/img/logo-spectate-dark.svg');background-size:25%;",src:b.transparentSrc,"data-mce-placeholder":"","data-mce-object-class":d.attr("class"),"data-mce-object-style":d.attr("style"),"data-mce-spectate-domain":d.attr("data-spectate-domain"),"data-mce-spectate-form":d.attr("data-spectate-form"),"data-mce-spectate-path":d.attr("data-spectate-path"),"data-mce-spectate-fscript":escape(f.value),"class":"mce-object mce-object-spectate"}),d.replace(g))))}};return{placeHolderConverter:c}}),g("9",["5"],function(a){return a("tinymce.util.Tools")}),g("b",["5"],function(a){return a("tinymce.html.SaxParser")}),g("7",["9","b"],function(a,b){var c=function(c){var d={};return new b({validate:!1,start:function(b,c){"div"===b&&(d=a.extend(c.map,d))}}).parse(c),d.spectateform=d["data-spectate-form"],d};return{htmlToData:c}}),g("8",["5"],function(a){return a("tinymce.util.JSON")}),g("a",["5"],function(a){return a("tinymce.util.XHR")}),g("4",["7","8","9","a"],function(a,b,c,d){var e=function(a,e){var g="CONTEXT_PATH/ajax/getSpectateFormNames.act?api_key=",h=[];d.send({url:g+a.settings.spectate_key,error:function(){a.windowManager.close(),f("Unable to load available Spectate forms.",a)},success:function(d){var g=b.parse(d)||{errors:{error:d}};g.errors&&(a.windowManager.close(),f("Unable to load available Spectate Forms: "+g.errors.error,a)),h.push({text:"Select a Spectate form",value:""}),c.each(g.forms,function(a){h.push({text:a.form.name,value:a.form.id})}),e(a,h)}})},f=function(a,b){b.notificationManager.open({type:"error",text:a})},g=function(b){var c=b.selection.getNode();return c.getAttribute("data-mce-spectate-form")?a.htmlToData(b.serializer.serialize(c,{selection:!0})):{}},h=function(a,b){var c,d,e=a.dom.select("img[data-mce-spectate-form]");for(c=0;c<b.length;c++)for(d=e.length-1;d>=0;d--)b[c]===e[d]&&e.splice(d,1);a.selection.select(e[0])},i=function(a,b){var c=a.dom.select("img[data-mce-spectate-form]");a.insertContent(b),h(a,c),a.nodeChanged()},j=function(a,e){var h,j,k=function(c){var e="CONTEXT_PATH/ajax/getSpectateFormCode.act?form_id=<FORM_ID>&api_key=";return function(){var g=h.find("#spectateform").value();""===g&&f("Please choose a Spectate form to insert.",a),d.send({url:e.replace("<FORM_ID>",g)+a.settings.spectate_key,error:function(){f("Could not load Spectate Form.",a),c(a,"")},success:function(d){var e=b.parse(d)||{errors:{error:d}};e.errors&&(f("Spectate Form cannot be inserted: "+e.errors.error,a),c(a,"")),c(a,e.form.embed_code_v2)}})}};j=g(a),h=a.windowManager.open({title:"Insert/edit Spectate Form",data:j,body:[{name:"spectateform",label:"Spectate Form",type:"listbox",values:e,minWidth:"325",onPostRender:function(){var a=this;c.each(e,function(b){if(b.value===parseInt(j.spectateform,10))return a.value(b.value),!1})}}],onSubmit:k(i)})};return{buildSpectateFormList:e,showDialog:j}}),g("0",["1","2","3","4"],function(a,b,c,d){var e=function(b){b.on("preInit",function(){b.parser.addNodeFilter("div",c.placeHolderConverter(b)),b.serializer.addAttributeFilter("data-mce-spectate-form",function(b,c){for(var d,e,f,g,h,i,j,k,l=b.length;l--;)d=b[l],d.parent&&(h=d.attr("data-mce-spectate-domain")||"",i=d.attr("data-mce-spectate-form")||"",j=d.attr("data-mce-spectate-fscript")||"",k=d.attr("data-mce-spectate-path")||"",""!==h&&""!==i&&""!==j&&""!==k&&(e=new a("div",1),e.attr({"class":d.attr("data-mce-object-class")||"spectate-form",style:d.attr("data-mce-object-style")||null,"data-spectate-domain":h,"data-spectate-form":i,"data-spectate-form-height":d.attr("height")||"500","data-spectate-path":k}),f=new a("script",1),f.attr({type:"text/javascript"}),g=new a("#text",3),g.raw=!0,g.value=unescape(j),f.append(g),d.parent.insert(f,d),d.replace(e)))})}),this.showDialog=function(){d.buildSpectateFormList(b,d.showDialog)},b.addButton("spectate",{tooltip:"Insert/edit Spectate Form",onclick:this.showDialog,stateSelector:["img[data-mce-spectate-form]"]}),b.addMenuItem("spectate",{text:"Insert/edit Spectate Form",onclick:this.showDialog,context:"insert",stateSelector:["img[data-mce-spectate-form]"]})};return b.add("spectate",e),function(){}}),d("0")()}();